<!DOCTYPE html>
<html>

<head>
  <script src="app.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
    crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!-- <link rel="import" href="nav.html"> -->
  <title>Sign In | Course</title>
</head>

<body style="margin: 0px; border: 0px;">
  <!-- Navigation ---------------------------------------------------------------------- -->
  <div class="container-fluid">
    <div>
      <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #ca104e;">
        <a class="navbar-brand" href="index.html">
          <h3>WSA Academy</h3>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown"
          aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
          <ul class="navbar-nav">
            <li class="nav-item active">
              <a class="nav-link" href="#" onClick="LoadPage('showcourse', 'coursedisplay.html')">Courses
                <span class="sr-only">(current)</span>
              </a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
                Admin
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a class="dropdown-item" href="#" onclick="LoadPage('showcourse', 'createcourse.html')">Add Course</a>
                <a class="dropdown-item" href="#" onclick="LoadPage('showcourse', 'courselist.html')">View Courses</a>
                <hr>
                <a class="dropdown-item" href="#" onclick="LoadPage('showcourse', 'createuser.html')">Add Users</a>
                <a class="dropdown-item" href="#" onclick="LoadPage('showcourse', 'userlist.html')">View Users</a>
              </div>
            </li>
          </ul>
        </div>
      </nav>
    </div>


    <div id="showcourse" style="border:'1px'; width:'100%vah';"></div>

    <!-- Sign in form ----------------------------------------------------------------- -->

    <div id="login">
      <div class="row justify-content-md-left">
        <div class="col col-lg-3 col-md-auto col-sm-auto">
          <div class="card mt-5 ">
            <h5 class="card-header">Sign Up/ Login</h5>
            <div class="card-body">
              <form id="loginform" action="/api/session" method="POST">
                <div class="form-group">
                  <label for="exampleInputEmail1">Username</label>
                  <input type="text" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter username"
                    name="username">
                </div>
                <div class="form-group">
                  <label for="exampleInputPassword1">Password</label>
                  <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Enter password" name="password">
                </div>
                <div class="form-group"></div>

                <button type="submit" class="btn btn-danger" >Login</button>
                <button type="button" class="btn btn-danger" onclick="ShowRegisterWindow()">Register</button>
            </div>
            </form>
          </div>
        </div>
      </div>
    </div>


    <!--  Register Form  -----------------------------------------------------------------  -->
    <div id="register">
      <div class="row justify-content-md-left">
        <div class="col col-lg-3 col-md-auto col-sm-auto">
          <div class="card mt-5 ">
            <h5 class="card-header">New User Sign Up</h5>
            <div class="card-body">
              <form id="registerForm" action="/api/users" method="POST">
                <div class="form-group">
                  <label for="email">Username</label>
                  <input type="text" class="form-control" id="email"  placeholder="Enter username"
                    name="username">
                </div>
                <div class="form-group">
                  <label for="exampleInputPassword2">Password</label>
                  <input type="password" class="form-control" id="password" placeholder="Enter password" name="password">
                </div>
                <!-- <div class="form-group">
                  <label for="exampleInputPassword1">Retype Password</label>
                  <input type="password" class="form-control" id="retypepassword" placeholder="Enter password" name="password">
                </div> -->

                <div class="form-group">
                  <div class="btn-group" role="group">
                    <button id="userType" type="button" name="userrole" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                      aria-expanded="false">
                      Choose
                    </button>
                    <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                      <a class="dropdown-item" onclick="FixUserRole(this)">Teacher</a>
                      <a class="dropdown-item" onclick="FixUserRole(this)">Student</a>
                    </div>
                  </div>
                </div>
                <hr>
                <div class="form-group">
                <button type="submit" class="btn btn-danger" >Register</button>
              </div>
            </div>
            </form> 
          </div>
        </div>
      </div>
    </div>



    <script>
      // Load all Courses ----------------------------------------------------------------- 
      // Bind the forms

      document.getElementById("register").style.display = "none";

      function LoadPage(divName, fileName) {
        document.getElementById(divName).innerHTML = "<object width='100%' height='1000' type='text/html' data=" + fileName + ">"
      }

      function FixUserRole(arg) {
        document.getElementById("userType").innerHTML = arg.innerHTML;
        document.getElementById("userType").value = arg.innerHTML;
      }

      function ShowRegisterWindow() {
        document.getElementById("register").style.display = "block";
        document.getElementById("login").style.display = "none";
      }


      function bindForms() {
        console.log("------------------- "+document.querySelector("form").name);
        document.getElementById("registerForm")
          .addEventListener("submit", function (e) {

            // Stop it from submitting
            e.preventDefault();
            var formId = this.id;
            console.log(this.action)
            var path = this.action;

            var method = this.method.toUpperCase();

            // Turn the inputs into a payload object
            var payload = {};
            var elements = this.elements;
            for (var i = 0; i < elements.length; i++) {
            console.log("---------" + elements[i].type)
              if (elements[i].type !== 'submit' && elements[i].value !== ""&& elements[i].value !== "register") {

                //var valueOfElement = elements[i].type == 'checkbox' ? elements[i].checked : elements[i].value;

                var valueOfElement = elements[i].value;
                payload[elements[i].name] = valueOfElement;
              }
            }

            console.log(payload);

            var headers = {};
            // Submit the request
            submitRequest(path, method, payload, headers, handleSignIn);
            // if (formId == "loginform") {
            //   console.log("login Form Selected")
            //   submitRequest(path, method, payload, headers, handleSignIn);
            // } else if (formId == "registerForm") {
            //   console.log("Register Form Selected")
            //   submitRequest(path, method, payload, headers, RegistrationComplete);
            // } else {
            //   console.log("Form not Found")
           // }
          });
      }

      function handleSignIn(err, tokenObj) {

        console.log("------ -a-a-a-a-a-a-"+ tokenObj)
        if (!err) {
          console.log("Sign in successful");
          // Save the token to local storage
          saveToken(tokenObj);
          // Redirect to another page
          document.getElementById("login").style.display = "none";
          document.getElementById("register").style.display = "none";
          LoadPage('showcourse', 'coursedisplay.html');

        }
        else {
          // handle error
          var divplaceholder = "placeholder";
          alert("Sign in failed");
          displayError(divplaceholder, "Sign in failed. Try Again");
        }

      }

      function RegistrationComplete() {
        document.getElementById("register").style.display = "none";
        document.getElementById("login").style.display = "block";

      }
      bindForms();

    </script>
  </div>
</body>

</html>